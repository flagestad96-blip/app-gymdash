// src/i18n.ts — Internationalization foundation
import React, { createContext, useContext, useState, useCallback } from "react";
import { getSettingAsync, setSettingAsync } from "./db";

export type Locale = "nb" | "en";

// Translation key type — flat dot-notation keys
type TranslationMap = Record<string, string>;

const nb: TranslationMap = {
  // ── Navigation / Drawer ──
  "nav.home": "Hjem",
  "nav.log": "Logg",
  "nav.program": "Program",
  "nav.analysis": "Analyse",
  "nav.achievements": "Prestasjoner",
  "nav.body": "Kropp",
  "nav.calendar": "Kalender",
  "nav.settings": "Innstillinger",
  "nav.backup": "Backup / Import",

  // ── Common / Shared ──
  "common.save": "Lagre",
  "common.cancel": "Avbryt",
  "common.close": "Lukk",
  "common.delete": "Slett",
  "common.edit": "Rediger",
  "common.copy": "Kopier",
  "common.search": "S\u00f8k...",
  "common.ok": "OK",
  "common.error": "Feil",
  "common.done": "Ferdig",
  "common.yes": "Ja",
  "common.no": "Nei",
  "common.loading": "Laster...",
  "common.working": "Jobber...",
  "common.none": "Ingen",
  "common.today": "I dag",
  "common.kg": "kg",
  "common.sets": "Sett",
  "common.reps": "reps",
  "common.volume": "Volum",
  "common.duration": "Varighet",
  "common.exercises": "\u00D8velser",
  "common.workouts": "\u00D8kter",
  "common.day": "Dag",
  "common.days": "Dager",
  "common.week": "Uke",

  // ── Home Screen ──
  "home.title": "Gymdash",
  "home.greeting.night": "God natt",
  "home.greeting.morning": "God morgen",
  "home.greeting.afternoon": "God ettermiddag",
  "home.greeting.evening": "God kveld",
  "home.todayWorkout": "Dagens \u00f8kt",
  "home.thisWeek": "Denne uken",
  "home.recentPRs": "Siste PRs",
  "home.noWorkout": "Ingen \u00f8kt i dag enn\u00e5. Klar for \u00e5 trene?",
  "home.goToWorkout": "G\u00e5 til \u00f8kt",
  "home.startWorkout": "Start \u00f8kt",
  "home.nextWorkout": "Neste \u00f8kt",
  "home.startThisWorkout": "Start denne \u00f8kten",
  "home.andMore": "+ {count} til",
  "home.streak": "STREAK",
  "home.total": "TOTALT",
  "home.prType.heaviest": "Tungeste",
  "home.prType.e1rm": "e1RM",
  "home.prType.volume": "Volum",

  // ── Log Screen ──
  "log.title": "Logg",
  "log.subtitle": "Dagens \u00f8kt",
  "log.startWorkout": "Start \u00f8kt",
  "log.endWorkout": "Avslutt \u00f8kt",
  "log.confirmEnd": "Bekreft avslutt",
  "log.confirmEndMsg": "Avslutte \u00f8kten?",
  "log.noSets": "Ingen sett logget.",
  "log.warmup": "Oppvarming",
  "log.workingSet": "Arbeidssett",
  "log.addSet": "Legg til sett",
  "log.deleteSet": "Slett sett",
  "log.deleteSetConfirm": "Slette dette settet?",
  "log.setDeleted": "Sett slettet",
  "log.undo": "Angre",
  "log.weight": "Vekt",
  "log.plateCalc": "Skivefordeling",
  "log.perSide": "per side",
  "log.bar": "Stang",
  "log.notExact": "N\u00e6rmeste oppn\u00e5elige",
  "log.restTimer": "Hviletimer",
  "log.restDone": "Hvile ferdig!",
  "log.skipRest": "Hopp over",
  "log.notes": "Notater",
  "log.workoutNotes": "\u00D8kt-notater",
  "log.notesPlaceholder": "Notater for denne \u00f8kten...",
  "log.setNotePlaceholder": "Notat for dette settet...",
  "log.pr": "PR!",
  "log.newPR": "Ny PR!",
  "log.baseline": "Baseline",
  "log.previous": "Forrige",
  "log.noHistory": "Ingen historikk",
  "log.alternatives": "Alternativer",
  "log.swapExercise": "Bytt \u00f8velse",
  "log.progression.hold": "Hold vekt \u2014 prioriter kontroll/reps",
  "log.progression.increase": "\u00D8k vekt",
  "log.progression.deload": "Deload",
  "log.dayLabel": "Dag {n}",
  "log.lockedMsg": "\u00D8kt p\u00e5g\u00e5r \u2014 endringer l\u00e5st.",
  "log.readyForWorkout": "Klar for \u00f8kt",
  "log.backFriendly": "Ryggvennlig",
  "log.standard": "Standard",
  "log.activeWorkout": "Aktiv \u00f8kt",
  "log.noWorkout": "Ingen \u00f8kt",
  "log.lockedAlert": "L\u00e5st under aktiv \u00f8kt",
  "log.lockedSwitchDay": "Avslutt \u00f8kten f\u00f8r du bytter dag.",
  "log.sessionCard": "\u00D8KT",
  "log.duration": "Varighet",
  "log.sessionHint": "Start \u00f8kten for \u00e5 logge sett. Varighet lagres automatisk.",
  "log.sessionNotePlaceholder": "Notat for \u00f8kten...",
  "log.dayCard": "DAG",
  "log.nextSuggestion": "Neste forslag: Dag {n}",
  "log.jumpTo": "HOPP TIL",
  "log.alternativeFor": "Alternativ for {name}",
  "log.target": "M\u00e5l: {sets} sett \u00d7 {repMin}-{repMax} reps (+{inc}kg)",
  "log.lastSet": "Sist: {weight}x{reps} ({date})",
  "log.hintLabel": "Hint: {hint}",
  "log.useLast": "Bruk sist",
  "log.notePlaceholder": "Notat...",
  "log.restPrefix": "Pause: {time}",
  "log.addSetBtn": "+ Legg til sett",
  "log.restOff": "REST AV",
  "log.noSetsYet": "Ingen sett enda.",
  "log.bwMissing": "BW: mangler \u2013 legg inn i Kropp",
  "log.startWorkoutAlert": "Start \u00f8kt",
  "log.startWorkoutMsg": "Du m\u00e5 starte \u00f8kten for du logger sett.",
  "log.missingData": "Mangler data",
  "log.missingDataMsg": "Fyll inn vekt og reps f\u00f8rst.",
  "log.couldNotUpdate": "Kunne ikke oppdatere sett.",
  "log.deleteSetTitle": "Slette sett?",
  "log.deleteSetMsg": "Dette kan ikke angres.",
  "log.couldNotDelete": "Kunne ikke slette sett.",
  "log.newHeaviest": "Ny tungeste: {weight} kg",
  "log.newE1rm": "Ny e1RM PR: {weight} kg",
  "log.newVolume": "Ny volum PR: {weight}",
  "log.superset": "Superset",
  "log.nextLabel": "Neste: {label}",
  "log.chooseAlternative": "Velg alternativ",
  "log.selected": "\u2713 Valgt",
  "log.lowerBack": "\u26a0\ufe0f Korsrygg",
  "log.backFriendlyTag": "\u2713 Ryggvennlig",
  "log.chooseDay": "Velg dag",
  "log.editSet": "Rediger sett",
  "log.restTimerTitle": "Rest timer",
  "log.restActive": "Aktiv",
  "log.restHaptics": "Haptics",
  "log.restVibrate": "Vibrer",
  "log.restLength": "Lengde (sekunder)",
  "log.useRecommended": "Bruk anbefalt ({seconds}s)",
  "log.reset": "Reset",
  "log.progression.nextIncrease": "Neste \u00f8kt: \u00f8k vekt litt",
  "log.progression.reduceWeight": "Vurder \u00e5 redusere vekt",
  "log.progression.buildReps": "Bygg reps innen range",
  "log.progression.keepBuilding": "Fortsett \u00e5 bygge reps",
  "log.dayChip": "Dag: {n}",

  // ── Program Screen ──
  "program.title": "Program",
  "program.subtitle": "Treningsprogram",
  "program.programs": "PROGRAMMER",
  "program.weekOverview": "UKEOVERSIKT",
  "program.active": "AKTIV",
  "program.setActive": "SETT AKTIV",
  "program.newProgram": "Nytt program",
  "program.duplicate": "Dupliser",
  "program.rename": "Gi nytt navn",
  "program.deleteProgram": "Slett program",
  "program.deleteProgramConfirm": "Slett program?",
  "program.cannotDeleteDefault": "Kan ikke slette default-program.",
  "program.noUndoWarning": "Dette kan ikke angres.",
  "program.addExercise": "Legg til \u00f8velse",
  "program.addSuperset": "Legg til supersett",
  "program.noBlocks": "Ingen blokker. Legg til \u00f8velser.",
  "program.chooseExercise": "Velg \u00f8velse",
  "program.alternatives": "Alternativer",
  "program.targets": "M\u00e5l per \u00f8velse",
  "program.repRange": "Rep range",
  "program.setsCount": "Antall sett",
  "program.increment": "Increment (kg)",
  "program.daysCount": "Antall dager",
  "program.lockedDuringWorkout": "Avslutt \u00f8kten f\u00f8r du gj\u00f8r endringer i programmet.",
  "program.noExercises": "Ingen \u00f8velser.",
  "program.noResults": "Ingen treff.",
  "program.export": "Eksporter",
  "program.import": "Importer",
  "program.name": "Navn",
  "program.invalidJson": "Ugyldig JSON",
  "program.invalidFormat": "Ugyldig format",
  "program.importSuccess": "Program er importert.",
  "program.importFailed": "Import feilet. Sjekk formatet.",
  "program.activeDay": "Aktiv dag",
  "program.programLabel": "Program",
  "program.workoutInProgress": "\u00D8kt p\u00e5g\u00e5r",
  "program.workoutLockedDay": "\u00D8kt p\u00e5g\u00e5r (Dag {n}) \u2013 endringer l\u00e5st.",
  "program.weekOverviewDesc": "Trykk p\u00e5 en dag for \u00e5 \u00e5pne editor. Bytt \u00f8velser om du m\u00e5.",
  "program.lockedSwitchProgram": "Avslutt \u00f8kten f\u00f8r du bytter program.",
  "program.lockedEditDays": "Avslutt \u00f8kten f\u00f8r du redigerer dager.",
  "program.lockedSwitchDay": "Avslutt \u00f8kten f\u00f8r du bytter aktiv dag.",
  "program.cannotDeleteDefaultMsg": "Du kan duplisere og redigere i stedet.",
  "program.duplicateProgram": "Dupliser program",
  "program.remove": "Fjern",
  "program.targetBtn": "M\u00e5l",
  "program.clear": "T\u00f8m",
  "program.exportProgram": "Eksporter program",
  "program.importProgram": "Importer program",
  "program.chooseExerciseB": "Velg \u00f8velse B (A er {name}).",
  "program.mustHaveName": "Program m\u00e5 ha name",
  "program.mustHave1to10Days": "Program m\u00e5 ha 1\u201310 dager",
  "program.invalidDayFormat": "Ugyldig day-format",
  "program.invalidBlock": "Ugyldig blokk",
  "program.singleMissingExId": "Single blokk mangler exId",
  "program.supersetMissingAB": "Superset mangler a/b",
  "program.unknownBlockType": "Ukjent blokk-type",
  "program.createCustom": "Opprett \u00f8velse",
  "program.editCustom": "Rediger \u00f8velse",
  "program.deleteCustom": "Slett \u00f8velse",
  "program.exerciseName": "\u00d8velsesnavn",
  "program.equipment": "Utstyr",
  "program.selectTags": "Velg merkelapper (maks 4)",
  "program.customExercise": "EGEN",
  "program.deleteCustomConfirm": "Slette denne egne \u00f8velsen?",
  "program.customExInUse": "Denne \u00f8velsen brukes i programmer.",
  "program.autoProgress": "Auto-progresjon",

  // ── Progression ──
  "progression.suggestions": "Progresjonsforslag",
  "progression.apply": "Bruk",
  "progression.dismiss": "Avvis",

  // ── Analysis Screen ──
  "analysis.title": "Analyse",
  "analysis.subtitle": "Statistikk og grafer",
  "analysis.range": "RANGE",
  "analysis.week": "UKE",
  "analysis.month": "M\u00C5NED",
  "analysis.year": "\u00C5R",
  "analysis.strengthIndex": "STRENGTH INDEX",
  "analysis.volume": "VOLUM",
  "analysis.muscleGroups": "MUSKELGRUPPER (HARD SETS)",
  "analysis.consistency": "KONSISTENS",
  "analysis.exercise": "\u00D8VELSE",
  "analysis.stats": "STATISTIKK",
  "analysis.prs": "PRS",
  "analysis.progression": "OVERALL PROGRESJON",
  "analysis.sessionTime": "\u00D8KT-TID (SNITT)",
  "analysis.noData": "Ingen data i valgt periode.",
  "analysis.noSetsLogged": "Ingen sett logget for valgt \u00f8velse enda.",
  "analysis.noPRData": "Ingen PR-data for valgt \u00f8velse.",
  "analysis.showingData": "Viser data fra siste {n} dager.",
  "analysis.bestWeight": "Beste vekt",
  "analysis.bestE1rm": "Beste est. 1RM",
  "analysis.avgReps": "Snitt reps",
  "analysis.setsInPeriod": "Sett i perioden",
  "analysis.prHeaviest": "Tungeste",
  "analysis.prE1rm": "e1RM",
  "analysis.prVolume": "Volum-sett",
  "analysis.tooLittle": "for lite",
  "analysis.tooMuch": "mye",
  "analysis.ok": "ok",
  "analysis.dailyVolume": "Daglig volum (sum kg x reps).",
  "analysis.weeklyVolume": "Ukentlig volum i perioden.",
  "analysis.monthlyVolume": "M\u00e5nedlig volum i perioden.",
  "analysis.chooseExercise": "Velg \u00f8velse",
  "analysis.noMatch": "Ingen treff.",
  "analysis.graphNote": "Grafen bruker \u00ABbest set per dag\u00BB (estimert 1RM) for \u00e5 v\u00e6re stabil.",
  "analysis.avgNote": "Gjennomsnitt av \u00ABbeste sett\u00BB per \u00f8velse per dag (estimert 1RM).",
  "analysis.e1rmNote": "Basert p\u00e5 beste e1RM per \u00f8velse per \u00f8kt (uten warmup). Baseline = snitt av de 3 f\u00f8rste \u00f8ktene.",
  "analysis.tapToChoose": "Trykk for \u00e5 velge",
  "analysis.exercise1": "\u00D8velse 1",
  "analysis.exercise2": "\u00D8velse 2",
  "analysis.chooseSecondExercise": "Velg \u00f8velse \u00e5 sammenligne med",
  "analysis.compare": "Sammenlign",
  "analysis.goals": "M\u00e5l",
  "analysis.selectExerciseFirst": "Velg en \u00f8velse f\u00f8rst",
  "analysis.setGoal": "Sett m\u00e5l",
  "analysis.addGoal": "Legg til m\u00e5l",
  "analysis.goalTypeLabel": "M\u00e5ltype",
  "analysis.goalType.weight": "Vekt",
  "analysis.goalType.volume": "Volum",
  "analysis.goalType.reps": "Reps",
  "analysis.targetValue": "M\u00e5lverdi",
  "analysis.repsHint": "\u00D8nsket antall reps",
  "analysis.currentBest": "N\u00e5v\u00e6rende beste",
  "analysis.noPRYet": "Ingen PR enn\u00e5",
  "analysis.goalAchieved": "M\u00e5l n\u00e5dd!",
  "analysis.complete": "fullf\u00f8rt",
  "analysis.invalidGoalValue": "Ugyldig m\u00e5lverdi",
  "analysis.achievedGoals": "Oppn\u00e5dde m\u00e5l",
  "analysis.weekFrom": "Uke fra {week}",
  "analysis.noSessions": "Ingen \u00f8kter i valgt periode.",
  "analysis.weekLabel": "Uke {week}",
  "analysis.sessionsCount": "{count} \u00f8kter \u00b7 {min} min",
  "analysis.noCompleteSessions": "Ingen komplette \u00f8kter med starttid funnet i valgt periode.",
  "analysis.basedOnSessions": "Basert p\u00e5 {count} \u00f8kter (start til siste set).",
  "analysis.dayLabel": "Dag {day}",
  "analysis.noSetsInPeriod": "Ingen sett logget i valgt periode enda.",
  "analysis.close": "LUKK",

  // ── Calendar Screen ──
  "calendar.title": "Kalender",
  "calendar.subtitle": "Treningshistorikk",
  "calendar.month": "M\u00C5NED",
  "calendar.days": "DAGER",
  "calendar.workouts": "\u00D8KTER",
  "calendar.selectDate": "Velg en dato for \u00e5 se \u00f8kter.",
  "calendar.noWorkouts": "Ingen \u00f8kter p\u00e5 {date}.",
  "calendar.noSetsLogged": "Ingen sett logget i denne \u00f8kten.",
  "calendar.dayAbbr.mon": "M",
  "calendar.dayAbbr.tue": "T",
  "calendar.dayAbbr.wed": "O",
  "calendar.dayAbbr.thu": "T",
  "calendar.dayAbbr.fri": "F",
  "calendar.dayAbbr.sat": "L",
  "calendar.dayAbbr.sun": "S",
  "calendar.started": "Startet {time}",
  "calendar.note": "NOTAT",

  // ── Body Screen ──
  "body.title": "Kropp",
  "body.subtitle": "Vekt og BMI",
  "body.register": "REGISTRER",
  "body.recentMeasurements": "SISTE M\u00C5LINGER",
  "body.weightPlaceholder": "Vekt i dag (kg)",
  "body.notePlaceholder": "Notat (valgfritt)",
  "body.heightPlaceholder": "H\u00f8yde (cm)",
  "body.update": "Oppdater",
  "body.editing": "Redigerer",
  "body.noMeasurements": "Ingen m\u00e5linger enn\u00e5.",
  "body.invalidWeight": "Ugyldig vekt",
  "body.invalidWeightMsg": "Skriv inn en gyldig vekt i kg.",
  "body.deleteMeasurement": "Slett m\u00e5ling?",
  "body.date": "Dato: {date}",
  "body.bmi": "BMI: {value}",

  // ── Settings Screen ──
  "settings.title": "Innstillinger",
  "settings.subtitle": "System og backup",
  "settings.description": "Her styrer du standardvalg. (Logg har ogs\u00e5 timer-innstillinger via gear ved rest-chipen.)",
  "settings.programMode": "PROGRAMMODE",
  "settings.programMode.standard": "Standard",
  "settings.programMode.back": "Ryggvennlig",
  "settings.programMode.desc": "Dette bestemmer hvilket program som er default n\u00e5r du starter en \u00f8kt.",
  "settings.theme": "TEMA",
  "settings.theme.system": "System",
  "settings.theme.light": "Lys",
  "settings.theme.dark": "M\u00f8rk",
  "settings.theme.desc": "Velg lyst, m\u00f8rkt eller f\u00f8lg systemet.",
  "settings.defaultDay": "STANDARD DAG",
  "settings.defaultDay.desc": "Velg hvilken dag som er \u00ABdefault\u00BB n\u00e5r du \u00e5pner Logg.",
  "settings.restTimer": "REST TIMER (DEFAULT)",
  "settings.restTimer.active": "Aktiv som standard",
  "settings.restTimer.vibrate": "Vibrer (kun i app)",
  "settings.restTimer.length": "Lengde (sekunder)",
  "settings.restTimer.note": "(Expo Go: ingen \u00ABsikker\u00BB vibrering i bakgrunn/locked. Det tar vi i dev build senere.)",
  "settings.superset": "SUPERSET",
  "settings.superset.autoAlternate": "Auto annethvert sett",
  "settings.superset.desc": "N\u00e5r aktiv: + i supersett logger A, s\u00e5 B, s\u00e5 A, osv.",
  "settings.backup": "BACKUP",
  "settings.backup.desc": "Eksporter eller importer alt lokalt. Ingen data sendes noen steder.",
  "settings.backup.exportJson": "Eksporter JSON",
  "settings.backup.importJson": "Importer JSON",
  "settings.backup.exportCsv": "Eksporter CSV",
  "settings.backup.healthCheck": "Health check",
  "settings.shareProgram": "DEL PROGRAM",
  "settings.shareProgram.desc": "Eksporter eller importer kun aktivt program (ingen historikk).",
  "settings.shareProgram.export": "Eksporter program",
  "settings.shareProgram.import": "Importer program",
  "settings.dataCleanup": "DATA & RYDDING",
  "settings.dataCleanup.desc": "Rydd testdata og tomme \u00f8kter. Brukes etter import eller ved opprydding.",
  "settings.dataCleanup.open": "\u00C5pne",
  "settings.dataCleanup.deleteEmpty": "Slett tomme \u00f8kter",
  "settings.tools": "VERKT\u00D8Y",
  "settings.tools.resetWorkout": "Nullstill aktiv \u00f8kt",
  "settings.tools.showIntro": "Vis introduksjon igjen",
  "settings.tools.backupNote": "Bruk backup-funksjonen for eksport/import av hele databasen.",
  "settings.tools.sanityCheck": "Sanity check (dev)",
  "settings.language": "SPR\u00C5K",
  "settings.language.desc": "Velg spr\u00e5k for appen.",
  "settings.language.nb": "Norsk",
  "settings.language.en": "English",
  "settings.weightUnit": "VEKTENHET",
  "settings.weightUnit.desc": "Velg visningsenhet for vekt.",
  "settings.weightUnit.kg": "Kilogram (kg)",
  "settings.weightUnit.lbs": "Pund (lbs)",
  "settings.lockedDuringWorkout": "\u00D8kt p\u00e5g\u00e5r{day} \u2013 endringer l\u00e5st.",
  "settings.lockedAlert": "L\u00e5st under aktiv \u00f8kt",
  "settings.lockedAlertMsg": "Avslutt \u00f8kten f\u00f8r du bytter {setting}.",
  "settings.modal.backupExport": "Backup eksport",
  "settings.modal.csvExport": "CSV eksport",
  "settings.modal.backupImport": "Backup import",
  "settings.modal.dataCleanup": "Data & Rydding",
  "settings.modal.shareExport": "Del program (eksport)",
  "settings.modal.shareImport": "Del program (import)",
  "settings.paste": "Lim inn JSON",
  "settings.newProfile": "Ny profil (slett lokalt)",
  "settings.setActiveProgram": "Sett som aktivt program",
  "settings.copied": "Kopiert",
  "settings.copiedMsg": "JSON kopiert til utklippstavlen.",
  "settings.copyManual": "Kopier manuelt",
  "settings.copyManualMsg": "Marker teksten og kopier manuelt.",
  "settings.couldNotExport": "Kunne ikke generere backup.",
  "settings.couldNotExportProgram": "Kunne ikke eksportere program.",
  "settings.importDone": "Import ferdig",
  "settings.importDoneMsg": "Data er importert. Vil du rydde bort testdata n\u00e5?",
  "settings.importLater": "Senere",
  "settings.importCleanNow": "Rydd n\u00e5",
  "settings.importFailed": "Import feilet. Sjekk formatet.",
  "settings.healthCheck": "Health check",
  "settings.noOrphans": "Ingen orphan sets funnet.",
  "settings.orphansFound": "Fant {n} orphan sets. Vil du rydde?",
  "settings.ignore": "Ignorer",
  "settings.cleaned": "Ryddet",
  "settings.orphansCleaned": "Orphan sets slettet.",
  "settings.couldNotClean": "Kunne ikke rydde orphan sets.",
  "settings.resetAll": "Nullstill alt?",
  "settings.resetAllMsg": "Dette sletter all lokal data (\u00f8kter, sett, programmer, targets, PR). Fortsette?",
  "settings.deleteAll": "Slett alt",
  "settings.resetDone": "Nullstilt",
  "settings.resetDoneMsg": "Alt er slettet. Standardprogram er lagt tilbake.",
  "settings.couldNotReset": "Kunne ikke nullstille data.",
  "settings.resetWorkout": "Nullstill aktiv \u00f8kt?",
  "settings.resetWorkoutMsg": "Dette fjerner kun \"activeWorkoutId\" s\u00e5 du slipper \u00e5 v\u00e6re l\u00e5st i en \u00f8kt. Data i DB slettes ikke.",
  "settings.resetWorkoutDone": "Active workout er nullstilt.",
  "settings.noEmpty": "Ingen tomme \u00f8kter",
  "settings.noEmptyMsg": "Fant ingen \u00f8kter uten sett.",
  "settings.deleteEmpty": "Slett tomme \u00f8kter?",
  "settings.deleteEmptyMsg": "Slette {n} tomme \u00f8kter?",
  "settings.emptyDeleted": "Tomme \u00f8kter slettet.",
  "settings.couldNotDeleteEmpty": "Kunne ikke slette tomme \u00f8kter.",
  "settings.noSelection": "Ingen valgt",
  "settings.noSelectionMsg": "Velg \u00e9n eller flere \u00f8velser f\u00f8rst.",
  "settings.confirmDelete": "Bekreft sletting",
  "settings.confirmDeleteMsg": "Slette {sets} sett fra {exercises} \u00f8velse(r)?",
  "settings.historyDeleted": "Historikk slettet.",
  "settings.couldNotDelete": "Kunne ikke slette historikk.",
  "settings.selectNone": "Velg ingen",
  "settings.deleteSelected": "Slett valgte \u00f8velser",
  "settings.resetAllBtn": "Nullstill alt",
  "settings.possibleTest": "Mulig test\u2011\u00f8velse",
  "settings.noExercisesFound": "Ingen \u00f8velser funnet.",
  "settings.fetchingHistory": "Henter historikk...",
  "settings.schemaError": "Ugyldig schemaVersion",
  "settings.missingData": "Mangler programdata",
  "settings.backupEmpty": "Backup er tom eller mangler data.",
  "settings.backupTooNew": "Backup er nyere enn appen. Oppdater appen for \u00e5 importere.",
  "settings.newProfileConfirm": "Ny profil",
  "settings.newProfileMsg": "Dette sletter lokale data. Fortsette?",
  "settings.deleteAndImport": "Slett og importer",
  "settings.sanityOk": "Sanity check",
  "settings.sanityFailed": "Sanity check feilet",

  // ── Achievements Screen ──
  "achievements.title": "Prestasjoner",
  "achievements.subtitle": "{n} / {total} l\u00e5st opp",
  "achievements.filter": "Filter",
  "achievements.all": "Alle",
  "achievements.showUnlocked": "Vis kun l\u00e5ste opp",
  "achievements.tierCommon": "Vanlig",
  "achievements.tierRare": "Sjelden",
  "achievements.tierEpic": "Episk",
  "achievements.tierLegendary": "Legend\u00e6risk",
  "achievements.count": "{n} prestasjoner",
  "achievements.totalPoints": "{n} poeng totalt",
  "achievements.points": "{n} poeng",
  "achievements.unlocked": "L\u00e5st opp!",
  "achievements.toast": "Prestasjon l\u00e5st opp!",

  // ── Patch Notes ──
  "patchNotes.title": "Nyheter",
  "patchNotes.whatsNew": "Hva er nytt i v{version}",
  "patchNotes.new": "Nytt",
  "patchNotes.improved": "Forbedret",
  "patchNotes.fix": "Fiks",
  "patchNotes.0_0_5.homeScreen": "Ny hjemskjerm med daglig oppsummering, ukentlig statistikk og streak",
  "patchNotes.0_0_5.i18n": "Flerspr\u00e5kst\u00f8tte \u2014 norsk og engelsk",
  "patchNotes.0_0_5.achievements": "Prestasjonssystem med poeng og tier-niv\u00e5er",
  "patchNotes.0_0_5.calendarDetail": "Detaljvisning for \u00f8kter i kalenderen",
  "patchNotes.0_0_5.notes": "Notater per \u00f8kt og per sett",
  "patchNotes.0_0_5.graphs": "Forbedrede grafer med akser, rutenett og interaktive datapunkter",
  "patchNotes.0_0_5.modals": "Mer lesbare pop-up-menyer",
  "patchNotes.0_0_5.logo": "Ny app-logo og design",
  "patchNotes.0_0_5.encoding": "Fikset tegnsett-problemer i hint-tekster",
  "patchNotes.0_0_5.prBaseline": "F\u00f8rste sett registreres n\u00e5 som baseline uten PR-banner",
  "patchNotes.0_0_5.kgLabels": "KG/reps-labels alltid synlige i inputfelt",
  "patchNotes.0_0_1.initial": "F\u00f8rste versjon av Gymdash",

  // ── File Backup & Sharing (Tier 4) ──
  "settings.exportFile": "Eksporter til fil",
  "settings.importFile": "Importer fra fil",
  "settings.shareBackup": "Del backup",
  "settings.backupComplete": "Backup fullf\u00f8rt",
  "settings.backupSaved": "Backup lagret og delt.",
  "settings.importFileSuccess": "Fil importert.",
  "settings.importFileFailed": "Kunne ikke lese filen.",
  "settings.shareFailed": "Deling feilet",

  // ── Progress Photos (Tier 4) ──
  "body.addPhoto": "Legg til bilde",
  "body.addPhoto.camera": "Ta bilde",
  "body.addPhoto.gallery": "Velg fra galleri",
  "body.changePhoto": "Endre bilde",
  "body.removePhoto": "Fjern bilde",
  "body.viewPhoto": "Se bilde",
  "body.photoPermission": "Tilgang til kamera/galleri er n\u00f8dvendig.",

  // ── Social Sharing (Tier 4) ──
  "share.workout": "Del \u00f8kt",
  "share.program": "Del program",
  "share.achievement": "Del prestasjon",
  "share.failed": "Deling feilet.",

  // ── Workout Templates (Tier 5) ──
  "templates.title": "Maler",
  "templates.save": "Lagre som mal",
  "templates.load": "Last inn mal",
  "templates.name": "Malnavn",
  "templates.description": "Beskrivelse (valgfritt)",
  "templates.empty": "Ingen maler enn\u00e5.",
  "templates.delete": "Slett mal",
  "templates.deleteConfirm": "Slette denne malen?",
  "templates.exercises": "{count} \u00f8velser",
  "templates.lastUsed": "Sist brukt: {date}",
  "templates.saved": "Mal lagret!",
  "templates.loaded": "Mal lastet inn.",
  "templates.namePlaceholder": "Navn p\u00e5 mal...",

  // ── Periodization (Tier 5) ──
  "periodization.title": "Periodisering",
  "periodization.enabled": "Aktiv",
  "periodization.weeks": "Sykluslengde (uker)",
  "periodization.deload": "Deload-uke",
  "periodization.deloadPercent": "Deload-intensitet (%)",
  "periodization.currentWeek": "N\u00e5v\u00e6rende uke",
  "periodization.weekOf": "Uke {current} av {total}",
  "periodization.deloadBanner": "DELOAD \u2014 {percent}% intensitet",
  "periodization.deloadWeek": "DELOAD",

  // ── Advanced Analytics (Tier 5) ──
  "analysis.strengthStandards": "STYRKENIV\u00C5",
  "analysis.beginner": "Nybegynner",
  "analysis.novice": "Novise",
  "analysis.intermediate": "Mellomniv\u00e5",
  "analysis.advanced": "Avansert",
  "analysis.elite": "Elite",
  "analysis.bodyComposition": "KROPPSSAMMENSETNING",
  "analysis.weightTrend": "Vektutvikling (siste 90 dager)",
  "analysis.muscleBalance": "MUSKELBALANSE",
  "analysis.noBodyweight": "Ingen vektdata. Legg inn i Kropp.",
  "analysis.strengthLevel": "Niv\u00e5",
  "analysis.e1rmLabel": "e1RM",
  "analysis.ratio": "Ratio",
  "analysis.gender": "Kj\u00f8nn",
  "analysis.male": "Mann",
  "analysis.female": "Kvinne",

  // ── Notifications (Tier 5) ──
  "notifications.title": "VARSLER",
  "notifications.workoutReminders": "Treningsp\u00e5minnelser",
  "notifications.restDaySuggestions": "Hviledag-forslag",
  "notifications.reminderTime": "Tidspunkt",
  "notifications.permissionRequired": "Varslingstillatelse n\u00f8dvendig",
  "notifications.requestPermission": "Gi tillatelse",
  "notifications.enabled": "Aktivert",
  "notifications.restDayMessage": "Du har ikke trent p\u00e5 en stund. Tid for en \u00f8kt?",
};

const en: TranslationMap = {
  // ── Navigation / Drawer ──
  "nav.home": "Home",
  "nav.log": "Log",
  "nav.program": "Program",
  "nav.analysis": "Analysis",
  "nav.achievements": "Achievements",
  "nav.body": "Body",
  "nav.calendar": "Calendar",
  "nav.settings": "Settings",
  "nav.backup": "Backup / Import",

  // ── Common / Shared ──
  "common.save": "Save",
  "common.cancel": "Cancel",
  "common.close": "Close",
  "common.delete": "Delete",
  "common.edit": "Edit",
  "common.copy": "Copy",
  "common.search": "Search...",
  "common.ok": "OK",
  "common.error": "Error",
  "common.done": "Done",
  "common.yes": "Yes",
  "common.no": "No",
  "common.loading": "Loading...",
  "common.working": "Working...",
  "common.none": "None",
  "common.today": "Today",
  "common.kg": "kg",
  "common.sets": "Sets",
  "common.reps": "reps",
  "common.volume": "Volume",
  "common.duration": "Duration",
  "common.exercises": "Exercises",
  "common.workouts": "Workouts",
  "common.day": "Day",
  "common.days": "Days",
  "common.week": "Week",

  // ── Home Screen ──
  "home.title": "Gymdash",
  "home.greeting.night": "Good night",
  "home.greeting.morning": "Good morning",
  "home.greeting.afternoon": "Good afternoon",
  "home.greeting.evening": "Good evening",
  "home.todayWorkout": "Today's workout",
  "home.thisWeek": "This week",
  "home.recentPRs": "Recent PRs",
  "home.noWorkout": "No workout today yet. Ready to train?",
  "home.goToWorkout": "Go to workout",
  "home.startWorkout": "Start workout",
  "home.nextWorkout": "Next Workout",
  "home.startThisWorkout": "Start This Workout",
  "home.andMore": "+ {count} more",
  "home.streak": "STREAK",
  "home.total": "TOTAL",
  "home.prType.heaviest": "Heaviest",
  "home.prType.e1rm": "e1RM",
  "home.prType.volume": "Volume",

  // ── Log Screen ──
  "log.title": "Log",
  "log.subtitle": "Today's workout",
  "log.startWorkout": "Start workout",
  "log.endWorkout": "End workout",
  "log.confirmEnd": "Confirm end",
  "log.confirmEndMsg": "End this workout?",
  "log.noSets": "No sets logged.",
  "log.warmup": "Warm-up",
  "log.workingSet": "Working set",
  "log.addSet": "Add set",
  "log.deleteSet": "Delete set",
  "log.deleteSetConfirm": "Delete this set?",
  "log.setDeleted": "Set deleted",
  "log.undo": "Undo",
  "log.weight": "Weight",
  "log.plateCalc": "Plate breakdown",
  "log.perSide": "per side",
  "log.bar": "Bar",
  "log.notExact": "Closest achievable",
  "log.restTimer": "Rest timer",
  "log.restDone": "Rest done!",
  "log.skipRest": "Skip",
  "log.notes": "Notes",
  "log.workoutNotes": "Workout notes",
  "log.notesPlaceholder": "Notes for this workout...",
  "log.setNotePlaceholder": "Note for this set...",
  "log.pr": "PR!",
  "log.newPR": "New PR!",
  "log.baseline": "Baseline",
  "log.previous": "Previous",
  "log.noHistory": "No history",
  "log.alternatives": "Alternatives",
  "log.swapExercise": "Swap exercise",
  "log.progression.hold": "Hold weight \u2014 prioritize control/reps",
  "log.progression.increase": "Increase weight",
  "log.progression.deload": "Deload",
  "log.dayLabel": "Day {n}",
  "log.lockedMsg": "Workout in progress \u2014 changes locked.",
  "log.readyForWorkout": "Ready for workout",
  "log.backFriendly": "Back-friendly",
  "log.standard": "Standard",
  "log.activeWorkout": "Active workout",
  "log.noWorkout": "No workout",
  "log.lockedAlert": "Locked during active workout",
  "log.lockedSwitchDay": "End workout before switching day.",
  "log.sessionCard": "SESSION",
  "log.duration": "Duration",
  "log.sessionHint": "Start workout to log sets. Duration saved automatically.",
  "log.sessionNotePlaceholder": "Note for this workout...",
  "log.dayCard": "DAY",
  "log.nextSuggestion": "Next suggestion: Day {n}",
  "log.jumpTo": "JUMP TO",
  "log.alternativeFor": "Alternative for {name}",
  "log.target": "Target: {sets} sets \u00d7 {repMin}-{repMax} reps (+{inc}kg)",
  "log.lastSet": "Last: {weight}x{reps} ({date})",
  "log.hintLabel": "Hint: {hint}",
  "log.useLast": "Use last",
  "log.notePlaceholder": "Note...",
  "log.restPrefix": "Rest: {time}",
  "log.addSetBtn": "+ Add set",
  "log.restOff": "REST OFF",
  "log.noSetsYet": "No sets yet.",
  "log.bwMissing": "BW: missing \u2013 add in Body",
  "log.startWorkoutAlert": "Start workout",
  "log.startWorkoutMsg": "You must start a workout before logging sets.",
  "log.missingData": "Missing data",
  "log.missingDataMsg": "Enter weight and reps first.",
  "log.couldNotUpdate": "Could not update set.",
  "log.deleteSetTitle": "Delete set?",
  "log.deleteSetMsg": "This cannot be undone.",
  "log.couldNotDelete": "Could not delete set.",
  "log.newHeaviest": "New heaviest: {weight} kg",
  "log.newE1rm": "New e1RM PR: {weight} kg",
  "log.newVolume": "New volume PR: {weight}",
  "log.superset": "Superset",
  "log.nextLabel": "Next: {label}",
  "log.chooseAlternative": "Choose alternative",
  "log.selected": "\u2713 Selected",
  "log.lowerBack": "\u26a0\ufe0f Lower back",
  "log.backFriendlyTag": "\u2713 Back-friendly",
  "log.chooseDay": "Choose day",
  "log.editSet": "Edit set",
  "log.restTimerTitle": "Rest timer",
  "log.restActive": "Active",
  "log.restHaptics": "Haptics",
  "log.restVibrate": "Vibrate",
  "log.restLength": "Duration (seconds)",
  "log.useRecommended": "Use recommended ({seconds}s)",
  "log.reset": "Reset",
  "log.progression.nextIncrease": "Next session: increase weight slightly",
  "log.progression.reduceWeight": "Consider reducing weight",
  "log.progression.buildReps": "Build reps within range",
  "log.progression.keepBuilding": "Keep building reps",
  "log.dayChip": "Day: {n}",

  // ── Program Screen ──
  "program.title": "Program",
  "program.subtitle": "Training program",
  "program.programs": "PROGRAMS",
  "program.weekOverview": "WEEK OVERVIEW",
  "program.active": "ACTIVE",
  "program.setActive": "SET ACTIVE",
  "program.newProgram": "New program",
  "program.duplicate": "Duplicate",
  "program.rename": "Rename",
  "program.deleteProgram": "Delete program",
  "program.deleteProgramConfirm": "Delete program?",
  "program.cannotDeleteDefault": "Cannot delete the default program.",
  "program.noUndoWarning": "This cannot be undone.",
  "program.addExercise": "Add exercise",
  "program.addSuperset": "Add superset",
  "program.noBlocks": "No blocks. Add exercises.",
  "program.chooseExercise": "Choose exercise",
  "program.alternatives": "Alternatives",
  "program.targets": "Exercise targets",
  "program.repRange": "Rep range",
  "program.setsCount": "Number of sets",
  "program.increment": "Increment (kg)",
  "program.daysCount": "Number of days",
  "program.lockedDuringWorkout": "End workout before making changes to the program.",
  "program.noExercises": "No exercises.",
  "program.noResults": "No results.",
  "program.export": "Export",
  "program.import": "Import",
  "program.name": "Name",
  "program.invalidJson": "Invalid JSON",
  "program.invalidFormat": "Invalid format",
  "program.importSuccess": "Program imported.",
  "program.importFailed": "Import failed. Check the format.",
  "program.activeDay": "Active day",
  "program.programLabel": "Program",
  "program.workoutInProgress": "Workout in progress",
  "program.workoutLockedDay": "Workout in progress (Day {n}) \u2013 changes locked.",
  "program.weekOverviewDesc": "Tap a day to open editor. Swap exercises if needed.",
  "program.lockedSwitchProgram": "End workout before switching program.",
  "program.lockedEditDays": "End workout before editing days.",
  "program.lockedSwitchDay": "End workout before switching active day.",
  "program.cannotDeleteDefaultMsg": "You can duplicate and edit instead.",
  "program.duplicateProgram": "Duplicate program",
  "program.remove": "Remove",
  "program.targetBtn": "Target",
  "program.clear": "Clear",
  "program.exportProgram": "Export program",
  "program.importProgram": "Import program",
  "program.chooseExerciseB": "Choose exercise B (A is {name}).",
  "program.mustHaveName": "Program must have a name",
  "program.mustHave1to10Days": "Program must have 1\u201310 days",
  "program.invalidDayFormat": "Invalid day format",
  "program.invalidBlock": "Invalid block",
  "program.singleMissingExId": "Single block missing exId",
  "program.supersetMissingAB": "Superset missing a/b",
  "program.unknownBlockType": "Unknown block type",
  "program.createCustom": "Create Exercise",
  "program.editCustom": "Edit Exercise",
  "program.deleteCustom": "Delete Exercise",
  "program.exerciseName": "Exercise Name",
  "program.equipment": "Equipment",
  "program.selectTags": "Select tags (max 4)",
  "program.customExercise": "CUSTOM",
  "program.deleteCustomConfirm": "Delete this custom exercise?",
  "program.customExInUse": "This exercise is used in programs.",
  "program.autoProgress": "Auto-Progression",

  // ── Progression ──
  "progression.suggestions": "Progression Suggestions",
  "progression.apply": "Apply",
  "progression.dismiss": "Dismiss",

  // ── Analysis Screen ──
  "analysis.title": "Analysis",
  "analysis.subtitle": "Stats and graphs",
  "analysis.range": "RANGE",
  "analysis.week": "WEEK",
  "analysis.month": "MONTH",
  "analysis.year": "YEAR",
  "analysis.strengthIndex": "STRENGTH INDEX",
  "analysis.volume": "VOLUME",
  "analysis.muscleGroups": "MUSCLE GROUPS (HARD SETS)",
  "analysis.consistency": "CONSISTENCY",
  "analysis.exercise": "EXERCISE",
  "analysis.stats": "STATISTICS",
  "analysis.prs": "PRS",
  "analysis.progression": "OVERALL PROGRESSION",
  "analysis.sessionTime": "SESSION TIME (AVG)",
  "analysis.noData": "No data in selected period.",
  "analysis.noSetsLogged": "No sets logged for selected exercise yet.",
  "analysis.noPRData": "No PR data for selected exercise.",
  "analysis.showingData": "Showing data from last {n} days.",
  "analysis.bestWeight": "Best weight",
  "analysis.bestE1rm": "Best est. 1RM",
  "analysis.avgReps": "Avg reps",
  "analysis.setsInPeriod": "Sets in period",
  "analysis.prHeaviest": "Heaviest",
  "analysis.prE1rm": "e1RM",
  "analysis.prVolume": "Volume set",
  "analysis.tooLittle": "too little",
  "analysis.tooMuch": "too much",
  "analysis.ok": "ok",
  "analysis.dailyVolume": "Daily volume (sum kg x reps).",
  "analysis.weeklyVolume": "Weekly volume in period.",
  "analysis.monthlyVolume": "Monthly volume in period.",
  "analysis.chooseExercise": "Choose exercise",
  "analysis.noMatch": "No matches.",
  "analysis.graphNote": "Graph uses \u201Cbest set per day\u201D (estimated 1RM) for stability.",
  "analysis.avgNote": "Average of \u201Cbest set\u201D per exercise per day (estimated 1RM).",
  "analysis.e1rmNote": "Based on best e1RM per exercise per session (no warm-up). Baseline = avg of first 3 sessions.",
  "analysis.tapToChoose": "Tap to choose",
  "analysis.exercise1": "Exercise 1",
  "analysis.exercise2": "Exercise 2",
  "analysis.chooseSecondExercise": "Choose exercise to compare",
  "analysis.compare": "Compare",
  "analysis.goals": "Goals",
  "analysis.selectExerciseFirst": "Select an exercise first",
  "analysis.setGoal": "Set Goal",
  "analysis.addGoal": "Add Goal",
  "analysis.goalTypeLabel": "Goal Type",
  "analysis.goalType.weight": "Weight",
  "analysis.goalType.volume": "Volume",
  "analysis.goalType.reps": "Reps",
  "analysis.targetValue": "Target Value",
  "analysis.repsHint": "Desired number of reps",
  "analysis.currentBest": "Current best",
  "analysis.noPRYet": "No PR yet",
  "analysis.goalAchieved": "Goal achieved!",
  "analysis.complete": "complete",
  "analysis.invalidGoalValue": "Invalid goal value",
  "analysis.achievedGoals": "Achieved goals",
  "analysis.weekFrom": "Week from {week}",
  "analysis.noSessions": "No sessions in selected period.",
  "analysis.weekLabel": "Week {week}",
  "analysis.sessionsCount": "{count} sessions \u00b7 {min} min",
  "analysis.noCompleteSessions": "No complete sessions with start time found in selected period.",
  "analysis.basedOnSessions": "Based on {count} sessions (start to last set).",
  "analysis.dayLabel": "Day {day}",
  "analysis.noSetsInPeriod": "No sets logged in selected period yet.",
  "analysis.close": "CLOSE",

  // ── Calendar Screen ──
  "calendar.title": "Calendar",
  "calendar.subtitle": "Training history",
  "calendar.month": "MONTH",
  "calendar.days": "DAYS",
  "calendar.workouts": "WORKOUTS",
  "calendar.selectDate": "Select a date to view workouts.",
  "calendar.noWorkouts": "No workouts on {date}.",
  "calendar.noSetsLogged": "No sets logged in this workout.",
  "calendar.dayAbbr.mon": "M",
  "calendar.dayAbbr.tue": "T",
  "calendar.dayAbbr.wed": "W",
  "calendar.dayAbbr.thu": "T",
  "calendar.dayAbbr.fri": "F",
  "calendar.dayAbbr.sat": "S",
  "calendar.dayAbbr.sun": "S",
  "calendar.started": "Started {time}",
  "calendar.note": "NOTE",

  // ── Body Screen ──
  "body.title": "Body",
  "body.subtitle": "Weight and BMI",
  "body.register": "REGISTER",
  "body.recentMeasurements": "RECENT MEASUREMENTS",
  "body.weightPlaceholder": "Weight today (kg)",
  "body.notePlaceholder": "Note (optional)",
  "body.heightPlaceholder": "Height (cm)",
  "body.update": "Update",
  "body.editing": "Editing",
  "body.noMeasurements": "No measurements yet.",
  "body.invalidWeight": "Invalid weight",
  "body.invalidWeightMsg": "Enter a valid weight in kg.",
  "body.deleteMeasurement": "Delete measurement?",
  "body.date": "Date: {date}",
  "body.bmi": "BMI: {value}",

  // ── Settings Screen ──
  "settings.title": "Settings",
  "settings.subtitle": "System and backup",
  "settings.description": "Manage default settings here. (Log also has timer settings via gear at rest chip.)",
  "settings.programMode": "PROGRAM MODE",
  "settings.programMode.standard": "Standard",
  "settings.programMode.back": "Back-friendly",
  "settings.programMode.desc": "This determines which program is default when you start a workout.",
  "settings.theme": "THEME",
  "settings.theme.system": "System",
  "settings.theme.light": "Light",
  "settings.theme.dark": "Dark",
  "settings.theme.desc": "Choose light, dark, or follow system.",
  "settings.defaultDay": "DEFAULT DAY",
  "settings.defaultDay.desc": "Choose which day is default when you open Log.",
  "settings.restTimer": "REST TIMER (DEFAULT)",
  "settings.restTimer.active": "Active by default",
  "settings.restTimer.vibrate": "Vibrate (in-app only)",
  "settings.restTimer.length": "Duration (seconds)",
  "settings.restTimer.note": "(Expo Go: no background vibration. Coming in dev build.)",
  "settings.superset": "SUPERSET",
  "settings.superset.autoAlternate": "Auto alternate sets",
  "settings.superset.desc": "When active: + in superset logs A, then B, then A, etc.",
  "settings.backup": "BACKUP",
  "settings.backup.desc": "Export or import all local data. No data is sent anywhere.",
  "settings.backup.exportJson": "Export JSON",
  "settings.backup.importJson": "Import JSON",
  "settings.backup.exportCsv": "Export CSV",
  "settings.backup.healthCheck": "Health check",
  "settings.shareProgram": "SHARE PROGRAM",
  "settings.shareProgram.desc": "Export or import active program only (no history).",
  "settings.shareProgram.export": "Export program",
  "settings.shareProgram.import": "Import program",
  "settings.dataCleanup": "DATA & CLEANUP",
  "settings.dataCleanup.desc": "Clean test data and empty workouts. Use after import or cleanup.",
  "settings.dataCleanup.open": "Open",
  "settings.dataCleanup.deleteEmpty": "Delete empty workouts",
  "settings.tools": "TOOLS",
  "settings.tools.resetWorkout": "Reset active workout",
  "settings.tools.showIntro": "Show intro again",
  "settings.tools.backupNote": "Use backup for full database export/import.",
  "settings.tools.sanityCheck": "Sanity check (dev)",
  "settings.language": "LANGUAGE",
  "settings.language.desc": "Choose the app language.",
  "settings.language.nb": "Norsk",
  "settings.language.en": "English",
  "settings.weightUnit": "WEIGHT UNIT",
  "settings.weightUnit.desc": "Choose display unit for weight.",
  "settings.weightUnit.kg": "Kilograms (kg)",
  "settings.weightUnit.lbs": "Pounds (lbs)",
  "settings.lockedDuringWorkout": "Workout in progress{day} \u2013 changes locked.",
  "settings.lockedAlert": "Locked during active workout",
  "settings.lockedAlertMsg": "End workout before changing {setting}.",
  "settings.modal.backupExport": "Backup export",
  "settings.modal.csvExport": "CSV export",
  "settings.modal.backupImport": "Backup import",
  "settings.modal.dataCleanup": "Data & Cleanup",
  "settings.modal.shareExport": "Share program (export)",
  "settings.modal.shareImport": "Share program (import)",
  "settings.paste": "Paste JSON",
  "settings.newProfile": "New profile (delete local)",
  "settings.setActiveProgram": "Set as active program",
  "settings.copied": "Copied",
  "settings.copiedMsg": "JSON copied to clipboard.",
  "settings.copyManual": "Copy manually",
  "settings.copyManualMsg": "Select the text and copy manually.",
  "settings.couldNotExport": "Could not generate backup.",
  "settings.couldNotExportProgram": "Could not export program.",
  "settings.importDone": "Import done",
  "settings.importDoneMsg": "Data imported. Clean up test data now?",
  "settings.importLater": "Later",
  "settings.importCleanNow": "Clean now",
  "settings.importFailed": "Import failed. Check the format.",
  "settings.healthCheck": "Health check",
  "settings.noOrphans": "No orphan sets found.",
  "settings.orphansFound": "Found {n} orphan sets. Clean up?",
  "settings.ignore": "Ignore",
  "settings.cleaned": "Cleaned",
  "settings.orphansCleaned": "Orphan sets deleted.",
  "settings.couldNotClean": "Could not clean orphan sets.",
  "settings.resetAll": "Reset everything?",
  "settings.resetAllMsg": "This deletes all local data (workouts, sets, programs, targets, PRs). Continue?",
  "settings.deleteAll": "Delete all",
  "settings.resetDone": "Reset",
  "settings.resetDoneMsg": "All data deleted. Default program restored.",
  "settings.couldNotReset": "Could not reset data.",
  "settings.resetWorkout": "Reset active workout?",
  "settings.resetWorkoutMsg": "This only removes \"activeWorkoutId\" so you're no longer locked in a workout. DB data is not deleted.",
  "settings.resetWorkoutDone": "Active workout has been reset.",
  "settings.noEmpty": "No empty workouts",
  "settings.noEmptyMsg": "Found no workouts without sets.",
  "settings.deleteEmpty": "Delete empty workouts?",
  "settings.deleteEmptyMsg": "Delete {n} empty workouts?",
  "settings.emptyDeleted": "Empty workouts deleted.",
  "settings.couldNotDeleteEmpty": "Could not delete empty workouts.",
  "settings.noSelection": "None selected",
  "settings.noSelectionMsg": "Select one or more exercises first.",
  "settings.confirmDelete": "Confirm deletion",
  "settings.confirmDeleteMsg": "Delete {sets} sets from {exercises} exercise(s)?",
  "settings.historyDeleted": "History deleted.",
  "settings.couldNotDelete": "Could not delete history.",
  "settings.selectNone": "Select none",
  "settings.deleteSelected": "Delete selected exercises",
  "settings.resetAllBtn": "Reset all",
  "settings.possibleTest": "Possible test exercise",
  "settings.noExercisesFound": "No exercises found.",
  "settings.fetchingHistory": "Fetching history...",
  "settings.schemaError": "Invalid schemaVersion",
  "settings.missingData": "Missing program data",
  "settings.backupEmpty": "Backup is empty or missing data.",
  "settings.backupTooNew": "Backup is newer than the app. Update the app to import.",
  "settings.newProfileConfirm": "New profile",
  "settings.newProfileMsg": "This deletes local data. Continue?",
  "settings.deleteAndImport": "Delete and import",
  "settings.sanityOk": "Sanity check",
  "settings.sanityFailed": "Sanity check failed",

  // ── Achievements Screen ──
  "achievements.title": "Achievements",
  "achievements.subtitle": "{n} / {total} unlocked",
  "achievements.filter": "Filter",
  "achievements.all": "All",
  "achievements.showUnlocked": "Show unlocked only",
  "achievements.tierCommon": "Common",
  "achievements.tierRare": "Rare",
  "achievements.tierEpic": "Epic",
  "achievements.tierLegendary": "Legendary",
  "achievements.count": "{n} achievements",
  "achievements.totalPoints": "{n} points total",
  "achievements.points": "{n} points",
  "achievements.unlocked": "Unlocked!",
  "achievements.toast": "Achievement unlocked!",

  // ── Patch Notes ──
  "patchNotes.title": "What's New",
  "patchNotes.whatsNew": "What's new in v{version}",
  "patchNotes.new": "New",
  "patchNotes.improved": "Improved",
  "patchNotes.fix": "Fix",
  "patchNotes.0_0_5.homeScreen": "New home screen with daily summary, weekly stats and streak",
  "patchNotes.0_0_5.i18n": "Multi-language support — Norwegian and English",
  "patchNotes.0_0_5.achievements": "Achievement system with points and tier levels",
  "patchNotes.0_0_5.calendarDetail": "Detail view for workouts in the calendar",
  "patchNotes.0_0_5.notes": "Notes per workout and per set",
  "patchNotes.0_0_5.graphs": "Improved graphs with axes, grid lines and interactive data points",
  "patchNotes.0_0_5.modals": "More readable pop-up menus",
  "patchNotes.0_0_5.logo": "New app logo and design",
  "patchNotes.0_0_5.encoding": "Fixed character encoding issues in hint texts",
  "patchNotes.0_0_5.prBaseline": "First set now recorded as baseline without PR banner",
  "patchNotes.0_0_5.kgLabels": "KG/reps labels always visible in input fields",
  "patchNotes.0_0_1.initial": "First version of Gymdash",

  // ── File Backup & Sharing (Tier 4) ──
  "settings.exportFile": "Export to file",
  "settings.importFile": "Import from file",
  "settings.shareBackup": "Share backup",
  "settings.backupComplete": "Backup complete",
  "settings.backupSaved": "Backup saved and shared.",
  "settings.importFileSuccess": "File imported.",
  "settings.importFileFailed": "Could not read the file.",
  "settings.shareFailed": "Sharing failed",

  // ── Progress Photos (Tier 4) ──
  "body.addPhoto": "Add photo",
  "body.addPhoto.camera": "Take photo",
  "body.addPhoto.gallery": "Choose from gallery",
  "body.changePhoto": "Change photo",
  "body.removePhoto": "Remove photo",
  "body.viewPhoto": "View photo",
  "body.photoPermission": "Camera/gallery access is required.",

  // ── Social Sharing (Tier 4) ──
  "share.workout": "Share workout",
  "share.program": "Share program",
  "share.achievement": "Share achievement",
  "share.failed": "Sharing failed.",

  // ── Workout Templates (Tier 5) ──
  "templates.title": "Templates",
  "templates.save": "Save as template",
  "templates.load": "Load template",
  "templates.name": "Template name",
  "templates.description": "Description (optional)",
  "templates.empty": "No templates yet.",
  "templates.delete": "Delete template",
  "templates.deleteConfirm": "Delete this template?",
  "templates.exercises": "{count} exercises",
  "templates.lastUsed": "Last used: {date}",
  "templates.saved": "Template saved!",
  "templates.loaded": "Template loaded.",
  "templates.namePlaceholder": "Template name...",

  // ── Periodization (Tier 5) ──
  "periodization.title": "Periodization",
  "periodization.enabled": "Enabled",
  "periodization.weeks": "Cycle length (weeks)",
  "periodization.deload": "Deload week",
  "periodization.deloadPercent": "Deload intensity (%)",
  "periodization.currentWeek": "Current week",
  "periodization.weekOf": "Week {current} of {total}",
  "periodization.deloadBanner": "DELOAD \u2014 {percent}% intensity",
  "periodization.deloadWeek": "DELOAD",

  // ── Advanced Analytics (Tier 5) ──
  "analysis.strengthStandards": "STRENGTH STANDARDS",
  "analysis.beginner": "Beginner",
  "analysis.novice": "Novice",
  "analysis.intermediate": "Intermediate",
  "analysis.advanced": "Advanced",
  "analysis.elite": "Elite",
  "analysis.bodyComposition": "BODY COMPOSITION",
  "analysis.weightTrend": "Weight trend (last 90 days)",
  "analysis.muscleBalance": "MUSCLE BALANCE",
  "analysis.noBodyweight": "No weight data. Add in Body.",
  "analysis.strengthLevel": "Level",
  "analysis.e1rmLabel": "e1RM",
  "analysis.ratio": "Ratio",
  "analysis.gender": "Gender",
  "analysis.male": "Male",
  "analysis.female": "Female",

  // ── Notifications (Tier 5) ──
  "notifications.title": "NOTIFICATIONS",
  "notifications.workoutReminders": "Workout reminders",
  "notifications.restDaySuggestions": "Rest day suggestions",
  "notifications.reminderTime": "Time",
  "notifications.permissionRequired": "Notification permission required",
  "notifications.requestPermission": "Grant permission",
  "notifications.enabled": "Enabled",
  "notifications.restDayMessage": "You haven't trained in a while. Time for a workout?",
};

const translations: Record<Locale, TranslationMap> = { nb, en };

// ── State ──
let currentLocale: Locale = "nb";
let listeners: Array<() => void> = [];

export function getLocale(): Locale {
  return currentLocale;
}

export function setLocale(locale: Locale) {
  if (locale === currentLocale) return;
  currentLocale = locale;
  setSettingAsync("locale", locale).catch(() => {});
  for (const fn of listeners) fn();
}

export async function loadLocale() {
  try {
    const raw = await getSettingAsync("locale");
    if (raw === "en" || raw === "nb") {
      currentLocale = raw;
    }
  } catch {}
}

function subscribe(fn: () => void) {
  listeners.push(fn);
  return () => {
    listeners = listeners.filter((l) => l !== fn);
  };
}

/**
 * Get a translated string. Supports simple {key} interpolation.
 * Example: t("log.dayLabel", { n: 3 }) → "Dag 3"
 */
export function t(key: string, params?: Record<string, string | number>): string {
  const map = translations[currentLocale] ?? nb;
  let str = map[key] ?? nb[key] ?? key;
  if (params) {
    for (const [k, v] of Object.entries(params)) {
      str = str.replace(new RegExp(`\\{${k}\\}`, "g"), String(v));
    }
  }
  return str;
}

// ── React integration ──

type I18nContextValue = {
  locale: Locale;
  t: typeof t;
  setLocale: typeof setLocale;
};

const I18nContext = createContext<I18nContextValue>({
  locale: "nb",
  t,
  setLocale,
});

export function I18nProvider({ children }: { children: React.ReactNode }) {
  const [locale, setLocaleState] = useState<Locale>(currentLocale);

  React.useEffect(() => {
    return subscribe(() => {
      setLocaleState(currentLocale);
    });
  }, []);

  const value = React.useMemo<I18nContextValue>(
    () => ({ locale, t, setLocale }),
    [locale]
  );

  return React.createElement(I18nContext.Provider, { value }, children);
}

export function useI18n() {
  return useContext(I18nContext);
}
